{% extends "base.html" %}

{% block title %}Пообщаться{% endblock %}

{% block content %}
<div class="chat-container">
    <h2>Пообщаться с моделью</h2>
    
    {% if error %}
    <div class="alert alert-danger">
        {{ error }}
    </div>
    {% endif %}
    
    <div class="balance-info">
        <p>Текущий баланс: <strong>{{ current_user.balance.amount }} ₽</strong></p>
        <p>Каждое сообщение списывает 10 ₽ с вашего баланса</p>
    </div>

    <div class="chat-history">
        <h3>История сообщений</h3>
        {% if messages %}
            <div class="messages-list">
                {% for msg in messages %}
                <div class="message {% if msg.is_user %}user-message{% else %}bot-message{% endif %}">
                    <div class="message-header">
                        <span class="message-sender">
                            {% if msg.is_user %}Вы{% else %}Модель{% endif %}
                        </span>
                        <span class="message-time">{{ msg.timestamp }}</span>
                    </div>
                    <div class="message-content">{{ msg.content }}</div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p>Пока нет сообщений</p>
        {% endif %}
    </div>

    <div class="chat-form">
        <form method="POST" action="/api/MLTask/send_task_rpc">
            <input type="hidden" name="user_id" value="{{ current_user.id }}">
            
            <div class="form-group">
                <label for="message">Ваше сообщение</label>
                <textarea id="message" name="message" class="form-control" rows="4" required></textarea>
            </div>
            
            <button type="submit" class="btn btn-block">Отправить (10 ₽)</button>
        </form>
    </div>
</div>
{% endblock %}